os: osx
language: objective-c
env:
  matrix:
    # Set up python environment
    # Parameters:
    #     $install_type : {macpython|macports|homebrew|system}
    #         Type of Python to install
    #     $version :
    #         macpython : major.minor.micro e.g. "3.4.1"
    #         macports : major.minor e.g. "3.4"
    #         homebrew : major e.g "3"
    #         system : ignored (but required to be not empty)
    #     $venv_dir : {directory_name|not defined}
    #         If defined - make virtualenv in this directory, set python / pip
    #         commands accordingly
    # ARCH ???
    - INSTALL_TYPE=macpython VERSION=2.7.9
    - INSTALL_TYPE=macpython VERSION=3.5.0
    - INSTALL_TYPE=homebrew VERSION=3
    - INSTALL_TYPE=homebrew VERSION=2

install:
  - brew update
  - brew install swig
  - source terryfy/travis_tools.sh
  # Install Python and pip, maybe virtualenv
  - get_python_environment $INSTALL_TYPE $VERSION $VENV
  - ${PIP_CMD} install wheel
  - ${PIP_CMD} install delocate


script:
  - export PYTHON=`which python3`
  - "./build.sh picosat-960"
  - ${PYTHON_EXE} --version
  - ${PYTHON_EXE} setup.py bdist_wheel
  - delocate-listdeps dist/*.whl


deploy:
  skip_cleanup: true
  provider: s3
  access_key_id: AKIAJDNB65PKLACZDGYQ
  secret_access_key:
    secure: "SgKZC/pgaiNy0emGPGDoXvlzKU2//NA+Bii6NNlCcmoGwoGAiru0lLIWAWDkVAyQRQQJvRwj3LdqPitOpka2H1ljvnD0+lX7P+NtPIAneDMEFxCV3m+9t0CthtKCyqJt9cqtrb+O9P0po1+dt8cKtd8l0dd1N+dAIFMcO0amx8wabYqm5Cm1HVVXcq61RUJUUO3l9wdbFqIKL1ULG+DyA3lZX2WqHj/IsQHfLgkzV0H6eGStWl7TjlujweWOWXDGbv/kbg2r1mazs5pELiX6KFIkMErPXhXng5oOPgUQuiJAVRMRno1+W9j74nOWhO/7L90gBmkpnV5g3eoYDVETvUsPmsrUZEm+OFafwE2DdPoXmdBHl4OvDq0U2LiHErxMr7JWDpume4F+rPg4cufATovmQruYEclVaIheVvZlrke1QY+kbuAlCD5JKmcjwbrbqovZbR/8xXN8MQRJ4Mkte6zY4dunZA0dLuHukQHdFO2S5a5dIJSBnLGkFbmu/KoNVI2Jxl/M3wfwQub7oZ82107/GWFS1wRN+whJuGw+mPbVkvG8LlTWnjvWMTPEnMFp3FHl3265X+X70duroBVdqCMoiyed8olL6qlSCYmHAT6C+hOBQ0dSpz9bWLdlONE8UmCXEAtZN1jbO2/YNI/NcPKCtrc00U1w6X0wlpkNZa8="
  bucket: pysmt-pkgs
  region: eu-central-1
  local-dir: dist/
  on:
    branch: dist/macosx
    repo: pysmt/pyPicoSAT
